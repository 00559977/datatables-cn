
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Starter Template for Bootstrap</title>
    <!-- Bootstrap core CSS -->
    <link href="bootstrap-3.3.6-dist/css/bootstrap.min.css" rel="stylesheet">

    <link href="codemirror/codemirror.css" rel="stylesheet"/>
    <link href="codemirror/eclipse.css" rel="stylesheet"/>

    <style>
        body {
            padding-top: 50px;
        }
        .starter-template {
            padding: 40px 15px;
            text-align: center;
        }
    </style>
</head>

<body>

<nav class="navbar navbar-inverse navbar-fixed-top">

        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">DT-Code</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">DT-Code</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
                <li class="active"><a href="#">保存</a></li>
            </ul>
        </div><!--/.nav-collapse -->

</nav>

<div class="row">

    <div class="col-lg-2">
        <form style="padding:3px">
            <div class="form-group">
                <label for="jquerylist">jQuery</label>
                <select multiple class="form-control" ID="jquerylist">

                </select>
            </div>
            <div class="form-group">
                <label for="dtlist">Datatables-js</label>
                <select multiple class="form-control" ID="dtlist">

                </select>
            </div>
            <div class="form-group">
                <label for="dtlist">Datatables-css</label>
                <select multiple class="form-control" ID="dtcsslist">

                </select>
            </div>
            <div class="form-group">
                <label for="dtlist">bootstrap-js</label>
                <select multiple class="form-control" ID="btlist">

                </select>
            </div>
            <div class="form-group">
                <label for="dtlist">bootstrap-css</label>
                <select multiple class="form-control" ID="btcsslist">

                </select>
            </div>
            <div class="form-group">
                <label for="dtlist">js外链</label>
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="js外链">
                      <span class="input-group-btn">
                        <button class="btn btn-default" type="button">添加</button>
                      </span>
                </div><!-- /input-group -->
            </div>
            <div class="form-group">
                <label for="dtlist">css外链</label>
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="css外链">
                      <span class="input-group-btn">
                        <button class="btn btn-default" type="button">添加</button>
                      </span>
                </div><!-- /input-group -->
            </div>
            <div class="form-group">
                <label for="dtlist">资源列表</label>
                <textarea class="form-control" name="" id="resourselist" rows="10"></textarea>
            </div>
        </form>
    </div>

    <div class="col-lg-10">
        <!-- Nav tabs -->
        <ul class="nav nav-tabs" role="tablist">
            <li role="presentation" class="active"><a href="#html" aria-controls="html" role="tab" data-toggle="tab">HTML</a></li>
            <li role="presentation"><a href="#css" aria-controls="css" role="tab" data-toggle="tab">CSS</a></li>
            <li role="presentation"><a href="#javascript" aria-controls="javascript" role="tab" data-toggle="tab">JAVASCRIPT</a></li>
            <li role="presentation"><a href="#result" aria-controls="result" role="tab" data-toggle="tab">RESULT</a></li>
        </ul>

        <!-- Tab panes -->
        <div class="tab-content">
            <div role="tabpanel" class="tab-pane active" id="html">
            <textarea class="code_input" cols="40" id="html_code" rows="21">

            </textarea>
            </div>
            <div role="tabpanel" class="tab-pane" id="css">
            <textarea class="code_input" cols="40" id="css_code" rows="21">

            </textarea>
            </div>
            <div role="tabpanel" class="tab-pane" id="javascript">
            <textarea class="code_input" cols="40" id="js_code" rows="21">

            </textarea>
            </div>
            <div role="tabpanel" class="tab-pane" id="result">
                <iframe class="result_output" id="view" width="100%" height="500px" name="view" src="javascript:''" style="frameborder:0;"></iframe>
            </div>
        </div>
    </div>



</div>


<script id="result_html_tmpl" type="text/html">
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>DT-code</title>
    </head>
    <body>
        <p>Welcome</p>
    </body>
    </html>
</script>


<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="jquery.min.js"></script>
<script src="bootstrap-3.3.6-dist/js/bootstrap.min.js"></script>




<script src="codemirror/codemirror.js" type="text/javascript"></script>
<script src="codemirror/closetag.js" type="text/javascript"></script>
<script src="codemirror/searchcursor.js" type="text/javascript"></script>
<script src="codemirror/match-highlighter.js" type="text/javascript"></script>
<script src="codemirror/xml.js" type="text/javascript"></script>
<script src="codemirror/css.js" type="text/javascript"></script>
<script src="codemirror/javascript.js" type="text/javascript"></script>
<script src="codemirror/htmlmixed.js" type="text/javascript"></script>




<script>
    var html_code, css_code, js_code;
    var result_str;

    var result_html_tmpl = $("#result_html_tmpl").html();


    document.getElementById("html_code").value = '<table id="example"></table>';
    document.getElementById("css_code").value = 'body{ \n font-size:20px \n }';
    document.getElementById("js_code").value = 'console.log("welcome to use dt-code")';

    html_code = CodeMirror.fromTextArea(document.getElementById("html_code"), {
        lineNumbers: !0,
        matchBrackets: !0,
        lineWrapping: !0,
        mode: "text/html",
        tabSize: 2,
        wordWrap: true,
        autoCloseTags: true
    });

    css_code = CodeMirror.fromTextArea(document.getElementById("css_code"), {
        lineNumbers: !0,
        matchBrackets: !0,
        lineWrapping: !0,
        mode: "css",
        tabSize: 2,
        wordWrap: true,
        autoCloseTags: true
    });

    js_code = CodeMirror.fromTextArea(document.getElementById("js_code"), {
        lineNumbers: !0,
        matchBrackets: !0,
        lineWrapping: !0,
        mode: "javascript",
        tabSize: 2,
        wordWrap: true,
        autoCloseTags: true
    });

    $('a[data-toggle="tab"]').on('shown.bs.tab click', function (e) {
        var targtText = $(e.target).attr("aria-controls");
//        e.target // newly activated tab
//        e.relatedTarget // previous active tab
        if (targtText == "result") {
            runit();
        }
    });

    function runit(){
        $result_html_tmpl = $(result_html_tmpl);
        view.document.open();
        view.document.write($result_html_tmpl.html());

        creater_doc.init(view.document);


        var jquerylist_data = $("#jquerylist");
        var dtlist_data = $("#dtlist");
        var dtcsslist_data = $("#dtcsslist");
        var btlist_data = $("#btlist");
        var btcsslist_data = $("#btcsslist");

        resultcombine(jquerylist_data,false);
        resultcombine(btcsslist_data,true);
        resultcombine(dtcsslist_data,true);
        resultcombine(btlist_data,false);
        resultcombine(dtlist_data,false);

        creater_doc.createStyle(css_code.getValue());

        var divElement =creater_doc.createElement("div",html_code.getValue());
        creater_doc.doc.body.appendChild(divElement);
        creater_doc.createScriptContent(js_code.getValue());
        view.document.close();

        function resultcombine(data,type){
            var selectDom = data.data(data.attr("id")+"-data");
            var selectval = data.val();
            $(selectDom).each(function(index,obj){
                if(selectval){
                    for(var i = 0;i<selectval.length;i++){
                        if(selectval[i] == obj.id){
                            if(type){
                                creater_doc.createLink(obj.url);
                            }else{
                                creater_doc.createScript(obj.url)
                            }
                        }
                    }
                }
            });
        }
    }

    var creater_doc = {
        doc:null,
        init: function (odoc) {
            this.doc = odoc;
        },
        createScript: function (src) {
            var fileElement = this.doc.createElement("script");
            fileElement.type = "text/javascript";
            fileElement.src = src;
            this.doc.getElementsByTagName("head")[0].appendChild(fileElement);
        },
        createScriptContent: function (code) {
            var fileElement = this.doc.createElement("script");
            fileElement.type = "text/javascript";
            fileElement.innerHTML = code;
//            this.doc.getElementsByTagName("head")[0].appendChild(fileElement);
            this.doc.body.appendChild(fileElement);
        },
        createStyle: function (code) {
            var fileElement = this.doc.createElement("style");
            fileElement.innerHTML = code;
            this.doc.getElementsByTagName("head")[0].appendChild(fileElement);
        },
        createLink: function (src) {
            var fileElement = this.doc.createElement("link");
            fileElement.href = src;
            fileElement.rel = "stylesheet";
            this.doc.getElementsByTagName("head")[0].appendChild(fileElement);
        },
        createElement:function(ele,content){
            var fileElement = this.doc.createElement(ele);
            fileElement.innerHTML = content;
            return fileElement;
        }
    };

    function code_ajax(url,callback){
        $.ajax({
            url:url,
            success:function(data){
                callback(data);
            }
        });
    }

    selectCreate("jquery","jquerylist");
    selectCreate("datatables-js","dtlist");
    selectCreate("datatables-css","dtcsslist");
    selectCreate("bootstrap-js","btlist");
    selectCreate("bootstrap-css","btcsslist");

    function selectCreate(name,id){
        code_ajax("./assets/"+name+".txt",function(data){
            data = JSON.parse(data);
            var select = $("#"+id);
            select.data(id+"-data",data);
            $(data).each(function(index,obj){
                select.append("<option value='"+obj.id+"'>"+obj.name+" "+obj.version+"</option>");
            });
        });
    }

    $(document).on("change","select",function(){
        combineResourseList();
    });

    function combineResourseList(){
        var resourselist = "";
        var jquerylist_data = $("#jquerylist");
        var dtlist_data = $("#dtlist");
        var dtcsslist_data = $("#dtcsslist");
        var btlist_data = $("#btlist");
        var btcsslist_data = $("#btcsslist");

        resourselist = combine(resourselist,jquerylist_data);
        resourselist = combine(resourselist,btcsslist_data);
        resourselist = combine(resourselist,dtcsslist_data);
        resourselist = combine(resourselist,btlist_data);
        resourselist = combine(resourselist,dtlist_data);

        $("#resourselist").val(resourselist);

        function combine(resourselist,data){
            var selectDom = data.data(data.attr("id")+"-data");
            var selectval = data.val();
            $(selectDom).each(function(index,obj){
                if(selectval){
                    for(var i = 0;i<selectval.length;i++){
                        if(selectval[i] == obj.id){
                            resourselist += obj.url+"\n";
                        }
                    }
                }else{
                    return resourselist;
                }
            });
            return resourselist;
        }
    }


</script>
</body>
</html>
