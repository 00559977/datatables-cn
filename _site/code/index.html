<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>DT-code {beta 0.341}</title>
    <!-- Bootstrap core CSS -->
    <link href="bootstrap-3.3.6-dist/css/bootstrap.min.css" rel="stylesheet">

    <link href="codemirror/codemirror.css" rel="stylesheet"/>
    <link href="codemirror/eclipse.css" rel="stylesheet"/>

    <style>
        body {
            padding-top: 50px;
        }

        .starter-template {
            padding: 40px 15px;
            text-align: center;
        }
    </style>
</head>

<body>

<nav class="navbar navbar-inverse navbar-fixed-top">

    <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">DT-Code {beta 0.341}</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#">DT-Code</a>
    </div>
    <div id="navbar" class="collapse navbar-collapse">
        <ul class="nav navbar-nav">
            <li><a href="#" id="saveToFile">保存</a></li>
            <li><a href="http://datatables.club/blog/2016/06/26/dt-code-help-doc.html">帮助</a></li>
        </ul>
    </div><!--/.nav-collapse -->

</nav>

<div class="row col-lg-12">

    <div class="col-lg-2">
        <form style="padding:15px">
            <div class="form-group">
                <label for="jquerylist">jQuery</label>
                <select multiple class="form-control" ID="jquerylist">

                </select>
            </div>
            <div class="form-group">
                <label for="dtlist">Datatables-js</label>
                <select multiple class="form-control" ID="dtlist">

                </select>
            </div>
            <div class="form-group">
                <label for="dtlist">Datatables-css</label>
                <select multiple class="form-control" ID="dtcsslist">

                </select>
            </div>
            <div class="form-group">
                <label for="dtlist">bootstrap-js</label>
                <select multiple class="form-control" ID="btlist">

                </select>
            </div>
            <div class="form-group">
                <label for="dtlist">bootstrap-css</label>
                <select multiple class="form-control" ID="btcsslist">

                </select>
            </div>
          <!--  <div class="form-group">
                <label for="dtlist">js外链</label>
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="js外链">
                      <span class="input-group-btn">
                        <button class="btn btn-default" type="button">添加</button>
                      </span>
                </div>&lt;!&ndash; /input-group &ndash;&gt;
            </div>
            <div class="form-group">
                <label for="dtlist">css外链</label>
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="css外链">
                      <span class="input-group-btn">
                        <button class="btn btn-default" type="button">添加</button>
                      </span>
                </div>&lt;!&ndash; /input-group &ndash;&gt;
            </div>-->
            <div class="form-group">
                <label for="dtlist">引入的资源列表</label>
                <textarea class="form-control" name="" id="resourselist" rows="10"></textarea>
            </div>
        </form>
    </div>

    <div class="col-lg-10">
        <div class="row" style="padding:15px">
            <label>本地保存的代码</label>
            <div style="margin-top:20px;min-height:150px;max-height:200px;overflow-y:auto">
                <ul class="list-group" id="codelist">

                </ul>
            </div>
        </div>
        <hr>
        <div class="row">
            <!-- Nav tabs -->
            <ul class="nav nav-tabs" role="tablist">
                <li role="presentation" class="active"><a href="#html" aria-controls="html" role="tab" data-toggle="tab">HTML</a>
                </li>
                <li role="presentation"><a href="#css" aria-controls="css" role="tab" data-toggle="tab">CSS</a></li>
                <li role="presentation"><a href="#javascript" aria-controls="javascript" role="tab" data-toggle="tab">JAVASCRIPT</a>
                </li>
                <li role="presentation"><a href="#result" aria-controls="result" role="tab" data-toggle="tab">RESULT</a>
                </li>
            </ul>

            <!-- Tab panes -->
            <div class="tab-content">
                <div role="tabpanel" class="tab-pane active" id="html">
            <textarea class="code_input" id="html_code" rows="34">

            </textarea>
                </div>
                <div role="tabpanel" class="tab-pane" id="css">
            <textarea class="code_input" id="css_code" rows="34">

            </textarea>
                </div>
                <div role="tabpanel" class="tab-pane" id="javascript">
            <textarea class="code_input" id="js_code" rows="34">

            </textarea>
                </div>
                <div role="tabpanel" class="tab-pane" id="result"></div>
            </div>
        </div>

    </div>


</div>

<script id="codelistlitpl" type="text/html">
    <li class="list-group-item">
        <div>
            <span>{{d.name}}</span>
            <!-- Split button -->
            <div class="btn-group right">
                <button type="button" class="btn btn-primary" onclick="loadLocalCode('{{d.key}}')">加载</button>
                <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown"
                        aria-haspopup="true" aria-expanded="false">
                    <span class="caret"></span>
                    <span class="sr-only">Toggle Dropdown</span>
                </button>
                <ul class="dropdown-menu">
                    <li><a href="#" title="生成HTML" onclick="saveToFile('{{d.key}}')">生成</a></li>
                    <li role="separator" class="divider"></li>
                    <li><a href="#" onclick="delLocalCode('{{d.key}}')">删除</a></li>
                </ul>
            </div>
        </div>
    </li>
</script>


<script id="init_html_tpl" type="text/html">
    <table id="example" class="display" cellspacing="0" width="100%">
        <thead>
        <tr>
            <th>排名</th>
            <th>语言</th>
            <th>描述</th>
        </tr>
        </thead>
        <tfoot>
        <tr>
            <th>排名</th>
            <th>语言</th>
            <th>描述</th>
        </tr>
        </tfoot>
        <tbody>
        <tr>
            <td></td>
            <td>Java</td>
            <td>
                Java是一门面向对象编程语言，不仅吸收了C++语言的各种优点，还摒弃了C++里难以理解的多继承、指针等概念，因此Java语言具有功能强大和简单易用两个特征。Java语言作为静态面向对象编程语言的代表，极好地实现了面向对象理论，允许程序员以优雅的思维方式进行复杂的编程
            </td>
        </tr>
        <tr>
            <td></td>
            <td>C</td>
            <td>
                C语言是一门通用计算机编程语言，应用广泛。C语言的设计目标是提供一种能以简易的方式编译、处理低级存储器、产生少量的机器码以及不需要任何运行环境支持便能运行的编程语言。
            </td>
        </tr>
        <tr>
            <td></td>
            <td>C++</td>
            <td>
                C++是在C语言的基础上开发的一种面向对象编程语言，应用广泛；C++支持多种编程范式 －－面向对象编程、泛型编程和过程化编程。最新正式标准C++于2014年8月18日公布。[1]  其编程领域众广，常用于系统开发，引擎开发等应用领域，是至今为止最受广大程序员受用的最强大编程语言之一,支持类：封装、继承、多态等特性!
            </td>
        </tr>
        <tr>
            <td></td>
            <td>C#</td>
            <td>
                C#是微软公司发布的一种面向对象的、运行于.NET Framework之上的高级程序设计语言。并定于在微软职业开发者论坛(PDC)上登台亮相。C#是微软公司研究员Anders Hejlsberg的最新成果。C#看起来与Java有着惊人的相似；它包括了诸如单一继承、接口、与Java几乎同样的语法和编译成中间代码再运行的过程。但是C#与Java有着明显的不同，它借鉴了Delphi的一个特点，与COM（组件对象模型）是直接集成的，而且它是微软公司 .NET windows网络框架的主角。
            </td>
        </tr>
        <tr>
            <td></td>
            <td>Python</td>
            <td>
                Python（英国发音：/ˈpaɪθən/ 美国发音：/ˈpaɪθɑːn/）, 是一种面向对象、解释型计算机程序设计语言，由Guido van Rossum于1989年发明，第一个公开发行版发行于1991年。
            </td>
        </tr>
        <tr>
            <td></td>
            <td>PHP</td>
            <td>
                PHP（外文名:PHP: Hypertext Preprocessor，中文名：“超文本预处理器”）是一种通用开源脚本语言。语法吸收了C语言、Java和Perl的特点，利于学习，使用广泛，主要适用于Web开发领域。PHP 独特的语法混合了C、Java、Perl以及PHP自创的语法。它可以比CGI或者Perl更快速地执行动态网页。用PHP做出的动态页面与其他的编程语言相比，PHP是将程序嵌入到HTML（标准通用标记语言下的一个应用）文档中去执行，执行效率比完全生成HTML标记的CGI要高许多；PHP还可以执行编译后代码，编译可以达到加密和优化代码运行，使代码运行更快。
            </td>
        </tr>
        <tr>
            <td></td>
            <td>VisualBasic.NET</td>
            <td>
                Visual Basic.NET是基于微软.NET Framework之上的面向对象的编程语言。
            </td>
        </tr>
        <tr>
            <td></td>
            <td>JavaScript</td>
            <td>
                JavaScript一种直译式脚本语言，是一种动态类型、弱类型、基于原型的语言，内置支持类型。它的解释器被称为JavaScript引擎，为浏览器的一部分，广泛用于客户端的脚本语言，最早是在HTML（标准通用标记语言下的一个应用）网页上使用，用来给HTML网页增加动态功能。
            </td>
        </tr>
        <tr>
            <td></td>
            <td>Assembly Language</td>
            <td>
                汇编语言（assembly language）是一种用于电子计算机、微处理器、微控制器或其他可编程器件的低级语言，亦称为符号语言。在汇编语言中，用助记符（Mnemonics）代替机器指令的操作码，用地址符号（Symbol）或标号（Label）代替指令或操作数的地址。在不同的设备中，汇编语言对应着不同的机器语言指令集，通过汇编过程转换成机器指令。普遍地说，特定的汇编语言和特定的机器语言指令集是一一对应的,不同平台之间不可直接移植。[1]
            </td>
        </tr>
        <tr>
            <td></td>
            <td>Ruby</td>
            <td>
                Ruby，一种简单快捷的面向对象（面向对象程序设计）脚本语言，在20世纪90年代由日本人松本行弘(Yukihiro Matsumoto)开发，遵守GPL协议和Ruby License。它的灵感与特性来自于 Perl、Smalltalk、Eiffel、Ada以及 Lisp 语言。由 Ruby 语言本身还发展出了JRuby（Java平台）、IronRuby（.NET平台）等其他平台的 Ruby 语言替代品。Ruby的作者于1993年2月24日开始编写Ruby，直至1995年12月才正式公开发布于fj（新闻组）。因为Perl发音与6月诞生石pearl（珍珠）相同，因此Ruby以7月诞生石ruby（红宝石）命名。
            </td>
        </tr>
        <tr>
            <td></td>
            <td>Perl</td>
            <td>
                Perl，一种功能丰富的计算机程序语言，运行在超过100种计算机平台上，适用广泛，从大型机到便携设备，从快速原型创建到大规模可扩展开发。[1]
            </td>
        </tr>
        <tr>
            <td></td>
            <td>Delphi</td>
            <td>
                Delphi，是Windows平台下著名的快速应用程序开发工具(Rapid Application Development，简称RAD)。它的前身，即是DOS时代盛行一时的“BorlandTurbo Pascal”，最早的版本由美国Borland（宝兰）公司于1995年开发。主创者为Anders Hejlsberg。经过数年的发展，此产品也转移至Embarcadero公司旗下。Delphi是一个集成开发环境（IDE），使用的核心是由传统Pascal语言发展而来的Object Pascal，以图形用户界面为开发环境，透过IDE、VCL工具与编译器，配合连结数据库的功能，构成一个以面向对象程序设计为中心的应用程序开发工具。
            </td>
        </tr>
        <tr>
            <td></td>
            <td>VisualBasic</td>
            <td>
                Visual Basic是一种由 微软公司开发的结构化的、模块化的、面向对象的、包含协助开发环境的事件驱动为机制的可视化程序设计语言。这是一种可用于微软自家产品开发的语言。它源自于BASIC编程语言。VB拥有图形用户界面（GUI）和快速应用程序开发（RAD）系统，可以轻易的使用DAO、RDO、ADO连接数据库，或者轻松的创建Active X控件。程序员可以轻松的使用VB提供的组件快速建立一个应用程序。
            </td>
        </tr>
        <tr>
            <td></td>
            <td>Swift</td>
            <td>
                Swift，苹果于2014年WWDC（苹果开发者大会）发布的新开发语言，可与Objective-C*共同运行于Mac OS和iOS平台，用于搭建基于苹果平台的应用程序。
            </td>
        </tr>
        <tr>
            <td></td>
            <td>MATLAB</td>
            <td>
                MATLAB[1]  是美国MathWorks公司出品的商业数学软件，用于算法开发、数据可视化、数据分析以及数值计算的高级技术计算语言和交互式环境，主要包括MATLAB和Simulink两大部分。
            </td>
        </tr>
        <tr>
            <td></td>
            <td>Pascal</td>
            <td>
                Pascal的名称是为了纪念十七世纪法国著名哲学家和数学家Blaise Pascal而来的，它由瑞士Niklaus Wirth教授于六十年代末设计并创立的。
                Pascal语言语法严谨，层次分明，程序易写，可读性强，是第一个结构化编程语言。
            </td>
        </tr>
        <tr>
            <td></td>
            <td>Groovy</td>
            <td>
                Groovy是一种基于JVM（Java虚拟机）的敏捷开发语言，它结合了Python、Ruby和Smalltalk的许多强大的特性，Groovy 代码能够与 Java 代码很好地结合，也能用于扩展现有代码。由于其运行在 JVM 上的特性，Groovy 可以使用其他 Java 语言编写的库。
            </td>
        </tr>
        <tr>
            <td></td>
            <td>Objective-C</td>
            <td>
                Objective-C，通常写作ObjC或OC和较少用的Objective C或Obj-C，是扩充C的面向对象编程语言。它主要使用于Mac OS X和GNUstep这两个使用OpenStep标准的系统，而在NeXTSTEP和OpenStep中它更是基本语言。
            </td>
        </tr>
        <tr>
            <td></td>
            <td>R</td>
            <td>
                R是一种用于统计计算的编程语言，由奥克兰大学的Ross Ihaka 和 Robert Gentleman发明。如今被广泛地使用于统计分析、数据挖掘等方向。
            </td>
        </tr>
        <tr>
            <td></td>
            <td>PL/SQL</td>
            <td>
                PL/SQL也是一种程序语言，叫做过程化SQL语言（Procedural Language/SQL）。PL/SQL是Oracle数据库对SQL语句的扩展。在普通SQL语句的使用上增加了编程语言的特点，所以PL/SQL就是把数据操作和查询语句组织在PL/SQL代码的过程性单元中，通过逻辑判断、循环等操作实现复杂的功能或者计算的程序语言。
            </td>
        </tr>
        </tbody>
    </table>
</script>

<script id="init_css_tpl" type="text/css">
    body {
        font-size: medium;
        font-family: "Microsoft YaHei", Arial, Helvetical, sans-serif, "宋体";
    }
</script>
<!--https://www.sitepoint.com/whats-best-programming-language-learn-2016/-->
<script id="init_js_tpl" type="text/html">
    $(document).ready(function(){
    console.log("欢迎使用DataTables在线代码编辑，这是测试版本，功能还没有全部开发完，如果你发现错误或者有好的建议，欢迎发送到邮箱 thxopen@datatables.club");
    console.log("Welcome to use DT-code ,this is test version. The whole functions are not complete. If you find any problems or some advices,please send to my e-mail: thxopen@datatables.club");
    var t = $('#example').DataTable( {
    "dom":"plfrtip",
    "columnDefs": [ {
    "searchable": false,
    "orderable": false,
    "targets": 0
    } ]
    } );

    t.on( 'order.dt search.dt', function () {
    t.column(0, {search:'applied', order:'applied'}).nodes().each( function (cell, i) {
    cell.innerHTML = i+1;
    } );
    } ).draw();
    });
</script>


<!--tomato code-->
<script type="text/html" id="tomato_html">
    <!-- 主表 -->
    <table class="table table-striped table-bordered dataTable no-footer" id="inlineEditDataTable">
    </table>


    <!-- 常用数据表格 modal-->
    <div class="modal fade" id="oftenModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="often">常办事项</h4>
                </div>
                <div class="modal-body">
                    <table class="table table-striped table-bordered dataTable no-footer" style="width:100%"
                           id="oftenDataTable">
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary">我啥也不做</button>
                </div>
            </div>
        </div>
    </div>


    <!-- 预估时间 Modal -->
    <div class="modal fade" id="timeModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="timeModalLabel">增加预估时间</h4>
                </div>
                <div class="modal-body">
                    <p>
                        哎哟！番茄用完了，任务还没有完成，不要紧你可以做再次预估
                    </p>
                    <p>
                        这是你第次预估，你还剩次预估
                    </p>
                    <p>
                        PS：总共可以做三次预估，如果三次预估的时间里都没有完成，即任务还需要分细
                    </p>
                    <div class="input-group">
                        <label for="timeInput">请输入预估时间：</label>
                        <input type="text" id="timeInput" >
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary" onclick="addTomato()">增加预估</button>
                </div>
            </div>
        </div>
    </div>
</script>
<script type="text/html" id="tomato_js">
    /**
    * Created by datatables.club on 2016/5/26.
    */

    if (!window.localStorage) {
    alert('不支持 localStorage,会影响使用功能');
    }

    //重置正在编辑的行
    function restoreRow(oTable02, nRow) {
    var aData = oTable02.row(nRow).data();
    var json = {
    id: aData.id,
    name: aData.name,
    type: aData.type,
    color: aData.color,
    priority: aData.priority,
    done: aData.done,
    tiem: aData.time,
    action: aData.action
    };
    var arr = creater.createRowObj(json);
    oTable02.row(nRow).data(arr).draw();
    }

    //把当前行变为可编辑状态
    function editRow(oTable02, nRow) {
    var aData = oTable02.row(nRow).data();
    var jqTds = $('>td', nRow);
    $(jqTds[0]).html(creater.createPrioritySelect(aData.priority));
    $(jqTds[1]).html(creater.createInput(aData.name));
    $(jqTds[2]).html(creater.createInput(replaceSign(aData.time)));
    $(jqTds[3]).html(creater.createTypeSelect(aData.type));
    $(jqTds[4]).html(creater.createColorSelect(aData.color));
    $(jqTds[5]).html(formatDate(aData.id));
    $(jqTds[6]).html(creater.createButton("save"));
    oTable02.draw();
    dataManager.updateData(oTable02.data());
    }

    //添加一行
    function addRow() {
    // Only allow a new row when not currently editing
    if (nEditing !== null) {
    return;
    }

    var aiNew = oTable02.row.add(creater.createRowObj());
    var nRow = oTable02.row(aiNew[0]).node();
    editRow(oTable02, nRow);
    nEditing = nRow;

    $(aiNew).find('td:last-child').addClass('actions text-center');

    }

    //处理dt的内部数据，得到最简单的数据数组
    function dealwithData(tmpData) {
    var arrTmp = [];
    for (var i = 0; i < tmpData.length; i++) {
    arrTmp.push(tmpData[i]);
    }
    return arrTmp;
    }

    //我是女娲后人
    var creater = {
    //操作列的按钮创建
    "createButton": function (type) {
    if (type === 'save') {
    return '<a class="edit save" href="#" title="保存事项">保存</a>|' +
    '<a class="delete glyphicon glyphicon-remove-sign" href="#" title="移除该事项"></a>';
    } else {
    return '<a class="edit glyphicon glyphicon-edit" href="#" title="编辑事项"></a>|' +
    '<a class="tomato glyphicon glyphicon-apple" href="#" title="开启一个番茄钟"></a>|' +
    '<a class="addtomato glyphicon glyphicon-time" href="#" title="重新预估时间"></a>|' +
    '<a class="done glyphicon glyphicon-ok" href="#" title="完成该事项"></a>|' +
    '<a class="delete glyphicon glyphicon-remove-sign" href="#" title="移除该事项"></a>';
    }
    },
    //input生成
    "createInput": function (val) {
    return '<input type="text" value="' + val + '" class="form-control">';
    },
    /**
    * 创建类型 select
    */
    "createTypeSelect": function (val) {
    var typeArr = [0, 1, -1];
    return this.createSelect(typeArr, val, replaceValue);
    },
    /**
    * 创建select下拉框
    * @param arr 数组  [1,2,3,4]
    * @param val 默认选中的值
    * @param render 显示渲染
    * @returns {*|jQuery|HTMLElement}
    */
    "createSelect": function (arr, val, render) {
    var select = $("<select></select>");
    select.append("<option value=''>请选择</option>");
    for (var i = 0; i < arr.length; i++) {
    select.append("<option value='" + arr[i] + "'>" + render(arr[i]) + "</option>")
    }
    select.val(val);
    return select;
    },
    //创建背景颜色选择select
    "createColorSelect": function (val) {
    var select = $("<select></select>");
    select.append("<option value=''>" + replaceColor() + "</option>");
    select.append("<option value='0' style='background-color: " + replaceColor(0) + "'></option>");
    select.append("<option value='1' style='background-color: " + replaceColor(1) + "'></option>");
    select.append("<option value='-1' style='background-color: " + replaceColor(-1) + "'></option>");
    select.val(val).css("background-color", replaceColor(val));
    return select;
    },
    //创建优先级下拉框
    "createPrioritySelect": function (val) {
    var PriorityArr = ["", 1, 2, 3];
    return this.createSelect(PriorityArr, val, replacePriority);
    },
    //生成一个行对象
    "createRowObj": function (json) {
    var actionTem = creater.createButton();
    var id = json ? json.id || new Date().getTime() : new Date().getTime();
    var name = json ? json.name || "DataTable 中文网" : "DataTable 中文网";
    var type = json ? json.type || -1 : -1;
    var color = json ? json.color || replaceColor() : replaceColor();
    var priority = json ? json.priority || 0 : 0;
    var action = json ? json.action || actionTem : actionTem;
    var tiemArr = {"first": [], "second": [], "third": []};
    var time = json ? json.time || tiemArr : tiemArr;
    return {
    "id": id,
    "name": name,
    "type": type,
    "color": color,
    "priority": priority,
    "done": 0,
    "time": time,
    "action": action
    };
    }
    };


    //保存行，把数据写入dt的内部数据对象，并重绘表格
    function saveRow(oTable02, nRow) {
    var jqInputs = $('input', nRow);
    var jqSelects = $('select', nRow);
    var rowObj = oTable02.row(nRow);
    var id = rowObj.data().id;
    var done = rowObj.data().done;
    var timeData = rowObj.data().time;
    var time = toTime($(jqInputs[1]).val(), "first", timeData);
    var json = {
    id: id,
    name: $(jqInputs[0]).val(),
    priority: $(jqSelects[0]).val(),
    type: $(jqSelects[1]).val(),
    color: $(jqSelects[2]).val(),
    time: time,
    done: done,
    action: creater.createButton()
    };
    var tmpobj = creater.createRowObj(json);
    rowObj.data(tmpobj).draw();
    dataManager.updateData(oTable02.data());
    }

    //初始化数据，展示例子
    function getInfo() {
    /* 属性	描述	IE	F	O
    appCodeName	返回浏览器的代码名。	4	1	9
    appMinorVersion	返回浏览器的次级版本。	4	No	No
    appName	返回浏览器的名称。	4	1	9
    appVersion	返回浏览器的平台和版本信息。	4	1	9
    browserLanguage	返回当前浏览器的语言。	4	No	9
    cookieEnabled	返回指明浏览器中是否启用 cookie 的布尔值。	4	1	9
    cpuClass	返回浏览器系统的 CPU 等级。	4	No	No
    onLine	返回指明系统是否处于脱机模式的布尔值。	4	No	No
    platform	返回运行浏览器的操作系统平台。	4	1	9
    systemLanguage	返回 OS 使用的默认语言。	4	No	No
    userAgent	返回由客户机发送服务器的 user-agent 头部的值。	4	1	9
    userLanguage	返回 OS 的自然语言设置。*/
    var infos = [];
    createDemoData("appCodeName: " + navigator.appCodeName, infos);
    createDemoData("appName: " + navigator.appName, infos);
    createDemoData("appVersion: " + navigator.appVersion, infos);
    createDemoData("javaEnabled: " + navigator.javaEnabled(), infos);
    createDemoData("cookieEnabled: " + navigator.cookieEnabled, infos);
    createDemoData("onLine: " + navigator.onLine, infos);
    createDemoData("platform: " + navigator.platform, infos);
    createDemoData("systemLanguage: " + navigator.systemLanguage, infos);
    createDemoData("userAgent: " + navigator.userAgent, infos);
    createDemoData("userLanguage: " + navigator.userLanguage, infos);
    return infos;
    }

    function createDemoData(value, array) {
    var json = {};
    json.id = null;
    json.type = null;
    json.color = null;
    json.action = null;
    json.priority = null;
    json.done = null;
    json.time = null;
    json.name = value;
    array.push(creater.createRowObj(json));
    }

    //数据管理
    var dataManager = {
    //把dt的相关数据设置到浏览器本地缓存
    "setData": function (data) {
    var parseData = JSON.stringify(data);
    localStorage.setItem("datatables-cn-data", parseData);
    return parseData;
    },
    //更新浏览器本地缓存里dt的相关数据
    "updateData": function (data) {
    var loaclData = this.getData();
    // loaclData = JSON.parse(loaclData);
    loaclData.data.data = dealwithData(data);
    this.setData(loaclData);
    },
    //从浏览器本地缓存获取dt的所有相关数据
    "getData": function () {
    var loaclData = localStorage.getItem("datatables-cn-data");
    if (!loaclData) {
    loaclData = {
    "data": {
    "data": getInfo(),
    "rowVisibleFlag": false
    }
    };
    loaclData = this.setData(loaclData);
    }
    // console.log(loaclData);
    return JSON.parse(loaclData);
    // return loaclData;
    },
    //重新初始化数据
    "reInitData": function () {
    localStorage.removeItem("datatables-cn-data");
    this.getData();
    alert("请按F5");
    },
    "setVisibleForRow": function (flag) {
    var data = this.getData();
    // data = JSON.parse(data);
    data.data.rowVisibleFlag = flag;
    this.setData(data);
    },
    "getVisibleForRow": function () {
    var data = this.getData();
    // data = JSON.parse(data);
    return data.data.rowVisibleFlag;
    }
    };

    //颜色替换
    function replaceColor(i) {
    switch (parseInt(i)) {
    case 0:
    return "yellow";
    case 1:
    return "blue";
    case -1:
    return "green";
    default:
    return "white";
    }
    }

    //类型替换
    function replaceValue(i) {
    switch (parseInt(i)) {
    case 0:
    return "活动清单";
    case 1:
    return "杂项";
    case -1:
    return "今日代办";
    default:
    return "杂项";
    }
    }

    //重要程度
    function replacePriority(i) {
    switch (parseInt(i)) {
    case 0:
    return "None";
    case 1:
    return "<span style='color:red' title='重要程度最低'>!</span>";
    case 2:
    return "<span style='color:red' title='重要程度居中'>!!</span>";
    case 3:
    return "<span style='color:red' title='重要程度最高'>!!!</span>";
    default:
    return "None";
    }
    }
    //△▲○●□■
    function replaceSign(time) {
    //第一次预估
    var firstSign0 = "□", firstSing1 = "■";
    //第二次预估
    var secondSign0 = "○", secondSing1 = "●";
    //第三次预估
    var thirdSign0 = "△", thirdSign1 = "▲";
    var firstTime = time.first;
    var secondTime = time.second;
    var thirdTime = time.third;
    var str = "";
    str = appendTime(str, firstTime, firstSign0, firstSing1);
    str = appendTime(str, secondTime, secondSign0, secondSing1);
    str = appendTime(str, thirdTime, thirdSign0, thirdSign1);
    return str;
    }

    function appendTime(str, arr, sign0, sign1) {
    for (var i = 0; i < arr.length; i++) {
    if (!arr[i]) {
    str += sign0;
    } else {
    str += sign1;
    }
    }
    return str;
    }

    //格式化时间显示
    function formatDate(now) {
    now = new Date(now);
    var year = now.getFullYear();
    var month = now.getMonth() + 1;
    var date = now.getDate();
    var hour = now.getHours();
    var minute = now.getMinutes();
    var second = now.getSeconds();
    return year + "-" + month + "-" + date + "   " + hour + ":" + minute + ":" + second;
    }

    //设置DataTable全局默认值
    $.extend(true, $.fn.dataTable.defaults, {
    "language": {
    "url": "/assets/Chinese.txt"
    },
    "dom": "B<'#countTime'>R<'row'<'col-md-6'l><'col-md-6'f>r>" +
    "t" +
    "<'row'<'col-md-5 sm-center'i><'col-md-7 text-right sm-center'p>>"
    });

    //是用bootstrap渲染dt
    $.fn.dataTable.defaults.renderer = 'bootstrap';
    $.fn.dataTable.ext.renderer.pageButton.bootstrap = function (settings, host, idx, buttons, page, pages) {
    var api = new $.fn.dataTable.Api(settings);
    var classes = settings.oClasses;
    var lang = settings.oLanguage.oPaginate;
    var btnDisplay, btnClass;

    var attach = function (container, buttons) {
    var i, ien, node, button;
    var clickHandler = function (e) {
    e.preventDefault();
    if (e.data.action !== 'ellipsis') {
    api.page(e.data.action).draw(false);
    }
    };

    for (i = 0, ien = buttons.length; i < ien; i++) {
    button = buttons[i];

    if ($.isArray(button)) {
    attach(container, button);
    }
    else {
    btnDisplay = '';
    btnClass = '';

    switch (button) {
    case 'ellipsis':
    btnDisplay = '&hellip;';
    btnClass = 'disabled';
    break;

    case 'first':
    btnDisplay = lang.sFirst;
    btnClass = button + (page > 0 ?
    '' : ' disabled');
    break;

    case 'previous':
    btnDisplay = lang.sPrevious;
    btnClass = button + (page > 0 ?
    '' : ' disabled');
    break;

    case 'next':
    btnDisplay = lang.sNext;
    btnClass = button + (page < pages - 1 ?
    '' : ' disabled');
    break;

    case 'last':
    btnDisplay = lang.sLast;
    btnClass = button + (page < pages - 1 ?
    '' : ' disabled');
    break;

    default:
    btnDisplay = button + 1;
    btnClass = page === button ?
    'active' : '';
    break;
    }

    if (btnDisplay) {
    node = $('<li>', {
        'class': classes.sPageButton + ' ' + btnClass,
        'aria-controls': settings.sTableId,
        'tabindex': settings.iTabIndex,
        'id': idx === 0 && typeof button === 'string' ?
        settings.sTableId + '_' + button :
        null
        })
        .append($('<a>', {
            'href': '#'
            })
            .html(btnDisplay)
            )
            .appendTo(container);

            settings.oApi._fnBindAction(
            node, {action: button}, clickHandler
            );
            }
            }
            }
            };
            attach(
            $(host).empty().html('<ul class="pagination"/>').children('ul'),
            buttons
            );
            };

            //表格初始化
            //包含以下功能：
            /**
            * dom的应用
            * render的应用
            * 是用本地静态数据，而非ajax取数
            * 国际化
            * buttons的应用
            * 行内编辑保存
            * 表格的增删改查
            *
            */
            var oTable02Data = dataManager.getData();
            // oTable02Data = JSON.parse(oTable02Data);
            oTable02Data = oTable02Data.data.data;

            var oTable02 = $('#inlineEditDataTable').DataTable({
            "columnDefs": [
            {'title': "重要", 'targets': 0},
            {'title': "事项", 'targets': 1},
            {'title': "番茄", 'targets': 2},
            {'title': "类型", 'targets': 3},
            {'title': "背景", 'targets': 4},
            {'title': "时间", 'targets': 5},
            {'title': "操作", 'targets': 6}
            ],
            "order": [[3, "asc"], [0, "des"]],
            "columns": [
            {
            "data": "priority",
            "render": function (data, type, row, meta) {
            if (type == "display") {
            return replacePriority(data);
            }
            if (type == "sort") {
            return data;
            }
            return data;
            }
            },
            {"data": "name"},
            {
            "data": "time",
            "render": function (data, type, row, meta) {
            return replaceSign(data);
            }
            },
            {
            "data": "type",
            "render": function (data, type, row, meta) {
            if (type == "display") {
            return replaceValue(data);
            }
            if (type == "sort") {
            return data;
            }
            return data;
            }
            },
            {
            "data": "color",
            "render": function (data, type, row, meta) {
            if (type == "display") {
            return replaceColor(data);
            }
            if (type == "sort") {
            return data;
            }
            return data;
            }
            },
            {
            "data": null,
            "render": function (data, type, row, meta) {
            return formatDate(row.id);
            }
            },
            {"data": "action"}
            ],
            "data": oTable02Data,
            "createdRow": rowCallback,
            "rowCallback": rowCallback,
            "infoCallback": infoCallback,
            "buttons": [
            {
            extend: 'csv',
            text: '导出csv'
            },
            {
            text: '添加事项',
            action: function (e, dt, node, config) {
            e.preventDefault();
            addRow();
            }
            },
            {
            text: '添加常办事项',
            action: function (e, dt, node, config) {
            e.preventDefault();
            $('#oftenModal').modal("show");
            }
            },
            {
            text: '隐藏已完成的',
            action: function (e, dt, node, config) {
            e.preventDefault();
            dataManager.setVisibleForRow(false);
            oTable02.draw();
            }
            },
            {
            text: '显示已完成的',
            action: function (e, dt, node, config) {
            e.preventDefault();
            dataManager.setVisibleForRow(true);
            oTable02.draw();
            }
            },
            {
            text: "初始化",
            action: function (e, dt, node, config) {
            e.preventDefault();
            dataManager.reInitData();
            }
            }
            ]
            });

            function rowCallback(row, data, index) {
            $(row).css('background-color', replaceColor(data.color));
            var flag = dataManager.getVisibleForRow();
            if (data.done && !flag) {
            $(row).css("display", "none");
            } else {
            $(row).css("display", "");
            }
            }

            function infoCallback(settings, start, end, max, total, pre) {
            var api = this.api();
            var pageInfo = api.page.info();
            var data = api.data();
            var doneCount = 0;
            $(data).each(function (index, object) {
            if (object.done) {
            doneCount++;
            }
            });
            var flag = pageInfo.recordsTotal > 0 ? true : false;
            var startIndex = flag ? pageInfo.start + 1 : pageInfo.start;
            var info = '显示第 ' + startIndex + ' 至 ' + pageInfo.end +
            ' 项结果，共 ' + pageInfo.recordsTotal + ' 项';
            if (doneCount > 0) {
            info += '( ' + doneCount + ' 项已隐藏 )';
            }
            return info;
            }

            var oftenData = [
            {
            "name": "制作今日待办",
            "DT_RowAttr": {
            "id": new Date().getTime(),
            "name": "制作今日待办"
            }
            }, {
            "name": "收邮件",
            "DT_RowAttr": {
            "id": new Date().getTime(),
            "name": "收邮件"
            }
            }, {
            "name": "写总结报告",
            "DT_RowAttr": {
            "id": new Date().getTime(),
            "name": "写总结报告"
            }
            }, {
            "name": "发送工作总结给经理",
            "DT_RowAttr": {
            "id": new Date().getTime(),
            "name": "发送工作总结给经理"
            }
            }
            ];

            //表格二
            var oftenTable = $("#oftenDataTable").DataTable({
            "dom": "r<'row'<'col-md-6'l><'col-md-6'f>r>" +
            "t" +
            "<'row'<'col-md-6 sm-center'i><'col-md-6 text-right sm-center'p>>",
            "data": oftenData,
            "columns": [
            {"data": "name", "title": "名称"},
            {
            "data": null, "title": "操作",
            "defaultContent": '<a href="javascript:void(0)" class="view-detail">添加到表格中</a>'
            }
            ]
            });

            $('#oftenDataTable').on('click', 'a', function () {
            //如果有多个按钮，根据class名称区分
            if ($(this).hasClass("view-detail")) {
            // a标签在td，td 在tr
            // 这里要获取tr的对象，所以是 a标签的父级的父级
            var trObjData = $(this).parent().parent();
            var name = trObjData.attr("name");
            // Only allow a new row when not currently editing
            if (nEditing !== null) {
            return;
            }
            var json = {
            "name": name,
            "type": -1
            };
            oTable02.row.add(creater.createRowObj(json)).draw();
            dataManager.updateData(oTable02.data());
            nEditing = null;
            }
            });

            var nEditing = null;

            // 删除行初始化
            $(document).on("click", "#inlineEditDataTable a.delete", function (e) {
            e.preventDefault();
            var nRow = $(this).parents('tr')[0];
            var rowData = oTable02.row(nRow).data();
            var id = rowData.id;
            var itemName = rowData.name;
            var dtData = dealwithData(oTable02.data());
            var delFlag = confirm("确定删除此项" + itemName);
            if (delFlag) {
            var finalData = $.grep(dtData, function (n, i) {
            return n.id != id;
            });
            oTable02.row(nRow).remove().draw(false);
            dataManager.updateData(finalData);
            }
            if (NOTEFLAG == 1) {
            delCount++;
            if (delCount % 3 == 0) {
            var f = confirm("觉得这个例子怎么样？加群给个建议呗？");
            if (!f) {
            localStorage.setItem("datatables-cn-noteflag", 0);
            NOTEFLAG = 0;
            }
            }
            }
            });

            // 编辑行初始化
            $(document).on("click", "#inlineEditDataTable a.edit", function (e) {
            e.preventDefault();

            /* Get the row as a parent of the link that was clicked on */
            var nRow = $(this).parents('tr')[0];

            if (nEditing !== null && nEditing != nRow) {
            /* A different row is being edited - the edit should be cancelled and this row edited */
            restoreRow(oTable02, nEditing);
            editRow(oTable02, nRow);
            nEditing = nRow;
            }
            else if (nEditing == nRow && this.innerHTML == "保存") {
            /* This row is being edited and should be saved */
            saveRow(oTable02, nEditing);
            nEditing = null;
            }
            else {
            /* No row currently being edited */
            editRow(oTable02, nRow);
            nEditing = nRow;
            }
            });


            // 完成按钮初始化
            $(document).on("click", "#inlineEditDataTable a.done", function (e) {
            e.preventDefault();

            /* Get the row as a parent of the link that was clicked on */
            var nRow = $(this).parents('tr')[0];
            var singleData = oTable02.row(nRow).data();
            singleData.done = 1;
            oTable02.row(nRow).data(singleData).draw();
            dataManager.updateData(oTable02.data());

            });

            // 开启一个番茄
            $(document).on("click", "#inlineEditDataTable a.tomato", function (e) {
            e.preventDefault();

            /* Get the row as a parent of the link that was clicked on */
            var nRow = $(this).parents('tr')[0];
            var singleData = oTable02.row(nRow).data();

            if (checkIsNext(singleData.time.first) &&
            checkIsNext(singleData.time.second) &&
            checkIsNext(singleData.time.third)) {
            alert("你需要重新分解任务");
            return;
            }
            countTime();
            setTimeout(function () {
            tomato(singleData.time);
            oTable02.row(nRow).data(singleData).draw();
            dataManager.updateData(oTable02.data());
            }, GLOBELTIME * 1000);
            });

            // 增加一个番茄
            $(document).on("click", "#inlineEditDataTable a.addtomato", function (e) {
            e.preventDefault();

            /* Get the row as a parent of the link that was clicked on */
            var nRow = $(this).parents('tr')[0];
            var singleData = oTable02.row(nRow).data();

            if (checkIsNext(singleData.time.first) &&
            checkIsNext(singleData.time.second) &&
            checkIsNext(singleData.time.third)) {
            alert("你需要重新分解任务");
            } else {
            $("#timeModal").modal("show").data("currentRowData", singleData).data("nRow", nRow);
            }
            });

            /**
            * 完成一个tomato
            * @param time
            * @returns {*}
            */
            function tomato(time) {
            var firstObj = changeArrVal(time.first);
            time.first = firstObj.arr;
            var firstFlag = firstObj.flag;

            if (firstFlag) {
            var secondObj = changeArrVal(time.second);
            time.second = secondObj.arr;
            var secondFlag = secondObj.flag;

            if (secondFlag) {
            var thirdObj = changeArrVal(time.third);
            time.third = thirdObj.arr;
            var thirdFlag = thirdObj.flag;
            }
            }
            }

            /**
            * 添加番茄钟
            */
            function addTomato() {
            var time = $("#timeInput").val();
            var currentData = $("#timeModal").data("currentRowData");
            var nRow = $("#timeModal").data("nRow");
            var timeObj = currentData.time;
            if (!checkIsNext(timeObj.second)) {
            currentData.time = toTime(time, "second", timeObj);
            oTable02.row(nRow).data(currentData).draw();
            dataManager.updateData(oTable02.data());
            }
            if (checkIsNext(timeObj.second) && !checkIsNext(timeObj.third)) {
            currentData.time = toTime(time, "third", timeObj);
            oTable02.row(nRow).data(currentData).draw();
            dataManager.updateData(oTable02.data());
            }
            }

            /**
            * 消耗一个tomato
            * @param arr
            * @returns {{arr: *, flag: boolean}} 返回次预估是否已经用完
            */
            function changeArrVal(arr) {
            var flag = false;
            for (var i = 0; i < arr.length; i++) {
            if (arr[i] == 0) {
            arr[i] = 1;
            flag = false;
            break;
            } else {
            flag = true;
            }
            }
            return {"arr": arr, "flag": flag};
            }

            /**
            * 判断时间有没有用完
            * @param arr
            * @returns {*}
            */
            function checkIsNext(arr) {
            //表示用完了
            var over;
            for (var i = 0; i < arr.length; i++) {
            if (arr[i] == 0) {
            over = false;
            break;
            } else {
            over = true;
            }
            }
            return over;
            }

            /**
            * 改变番茄钟（重新做预估）
            * @param val
            * @param timeGroup
            * @param time
            * @returns {{first: *, second: *, third: *}}
            */
            function toTime(val, timeGroup, time) {
            var firstTime = time.first;
            var secondTime = time.second;
            var thirdTime = time.third;
            val = parseInt(val);
            //太多表示需要分解
            if (val > 4) val = 4;
            for (var i = 0; i < val; i++) {
            if (timeGroup === "first")
            firstTime.push(0);
            if (timeGroup === "second")
            secondTime.push(0);
            if (timeGroup === "third")
            thirdTime.push(0);
            }
            return {"first": firstTime, "second": secondTime, "third": thirdTime};
            }

            /**
            * 倒计时
            * @type {number}
            */
            var GLOBELTIME = 25*60;
            var intervalid;
            var msg = "";
            var s = "";
            function countTime(){
            intervalid = setInterval("funTime()", 1000);
            alert("你已经开启了一个番茄钟……");
            msg = "你开启了定时器，还剩";
            s = "秒";
            }
            function funTime() {
            if (GLOBELTIME == 0) {
            notifyMe();
            GLOBELTIME = 25*60;
            msg = "等待开启你的";
            s = "秒钟";
            clearInterval(intervalid);
            }
            document.getElementById("countTime").innerHTML = msg+GLOBELTIME+s;
            GLOBELTIME--;
            }



            // 加载本页面时，提示用户桌面提示的权限
            document.addEventListener('DOMContentLoaded', function () {
            if (Notification.permission !== "granted")
            Notification.requestPermission();
            });

            function notifyMe() {
            if (!Notification) {
            alert('你的浏览器不支持桌面提示，请使用chrome浏览器');
            return;
            }

            if (Notification.permission !== "granted")
            Notification.requestPermission();
            else {
            var notification = new Notification('时间到', {
            icon: 'http://datatables.club/images/favicon.png',
            body: "恭喜你完成一个番茄钟，接下来你可以放松5分钟，起来运动运动"
            });

            notification.onclick = function () {
            alert("你可以放松5分钟，起来运动运动");
            };

            }

            }

</script>


<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="scripts/jquery-2.0.0.js"></script>
<script src="scripts/jquery.storageapi.js"></script>
<script src="scripts/laytpl.js"></script>
<script src="bootstrap-3.3.6-dist/js/bootstrap.min.js"></script>


<script src="codemirror/codemirror.js" type="text/javascript"></script>
<script src="codemirror/formatting.js" type="text/javascript"></script>
<script src="codemirror/closetag.js" type="text/javascript"></script>
<script src="codemirror/searchcursor.js" type="text/javascript"></script>
<script src="codemirror/match-highlighter.js" type="text/javascript"></script>
<script src="codemirror/xml.js" type="text/javascript"></script>
<script src="codemirror/css.js" type="text/javascript"></script>
<script src="codemirror/javascript.js" type="text/javascript"></script>
<script src="codemirror/htmlmixed.js" type="text/javascript"></script>

<script src="scripts/filesaver.js" type="text/javascript"></script>



<script>
    //codemirror对象
    var html_code, css_code, js_code;

    var htmlcontent = "";

    $(document).ready(function () {

        //初始化代码
        initDTCodeFirst();

        html_code = initCodeMirror("html_code", "text/html", html_code);
        css_code = initCodeMirror("css_code", "text/css", css_code);
        js_code = initCodeMirror("js_code", "text/javascript", js_code);

        $('a[href="#result"]').on('shown.bs.tab click', function (e) {
            runit();
        });

        $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
            var targtText = $(e.target).attr("aria-controls");

            if (targtText == "css") {
                css_code = initCodeMirror("css_code", "text/css", css_code);
            }
            if (targtText == "javascript") {
                js_code = initCodeMirror("js_code", "text/javascript", js_code);
            }
        });

        $('a[data-toggle="tab"]').on("dblclick", function (e) {
            e.preventDefault();
            var targtText = $(e.target).attr("aria-controls");

            if (targtText == "css") {
                formatCode(css_code);
            }
            if (targtText == "javascript") {
                formatCode(js_code);
            }
            if (targtText == "html") {
                formatCode(html_code);
            }
        });

        selectCreate("jquery", "jquerylist");
        selectCreate("datatables-js", "dtlist");
        selectCreate("datatables-css", "dtcsslist");
        selectCreate("bootstrap-js", "btlist");
        selectCreate("bootstrap-css", "btcsslist");


        //保存当前代码到本地
        $("#saveToFile").click(function () {
            //baidu 真垃圾啊
//            var htmlFile = $("#view").contents().find("html").html();
            save_load.init();
            save_load.setCode(save_load.codeObj);
            save_load.createCodeList();
        });
        //生成代码列表
        save_load.createCodeList();
    });

    function initDTCodeFirst(){
        save_load.init();
        save_load.codeObj.csscode = $("#init_css_tpl").html();
        save_load.codeObj.htmlcode = $("#init_html_tpl").html();
        save_load.codeObj.jscode = $("#init_js_tpl").html();
        save_load.codeObj.resourse.jquerylist = ['343'];
        save_load.codeObj.resourse.dtlist = ['344'];
        save_load.codeObj.resourse.dtcsslist = ['351'];
        save_load.codeObj.key = "code_datatables_club_341";
        save_load.codeObj.name = "入门指导例子";
        save_load.setCode(save_load.codeObj);
        save_load.createCodeList();

        save_load.init();
        save_load.codeObj.csscode = $("#init_css_tpl").html();
        save_load.codeObj.htmlcode = $("#tomato_html").html();
        save_load.codeObj.jscode = $("#tomato_js").html();
        save_load.codeObj.resourse.jquerylist = ['343'];
        save_load.codeObj.resourse.dtlist = ['344','358','359','360','361','362','363','364','365'];
        save_load.codeObj.resourse.dtcsslist = ['357','366'];
        save_load.codeObj.resourse.btcsslist = ['355'];
        save_load.codeObj.resourse.btlist = ['354'];
        save_load.codeObj.key = "code_datatables_club_342";
        save_load.codeObj.name = "番茄钟（DataTables实现）";
        save_load.setCode(save_load.codeObj);
        save_load.createCodeList();

    }

    /**
     * 读取代码到编辑区域
     * @param key
     */
    function loadLocalCode(key){
        var code = save_load.getCode(key);
        js_code.setValue(code.jscode);
        css_code.setValue(code.csscode);
        html_code.setValue(code.htmlcode);

        $("#jquerylist").val(code.resourse.jquerylist);
        $("#dtlist").val(code.resourse.dtlist);
        $("#dtcsslist").val(code.resourse.dtcsslist);
        $("#btlist").val(code.resourse.btlist);
        $("#btcsslist").val(code.resourse.btcsslist);

    }

    /**
     * 删除本地代码
     * @param key
     */
    function delLocalCode(key){
        save_load.remove(key);
        save_load.createCodeList();
    }

    var save_load = {
        /**
         * 本地储存对象
         * 使用jquery 插件
         */
        loacl: $.localStorage,
        /**
         * 代码对象初始化
         * 使用前必须调用
         */
        init: function () {
            this.codeObj = this.createCodeObj();
        },
        /**
         * 返回一个代码对象
         * @returns {{key: string, name: null, jscode: null, csscode: null, htmlcode: null, resourse: {jquerylist: null, dtlist: null, dtcsslist: null, btlist: null, btcsslist: null}, type: null}}
         */
        createCodeObj: function () {
            return {
                "key": null,
                "name": null,
                "jscode": null,
                "csscode": null,
                "htmlcode": null,
                "resourse": {
                    "jquerylist": null,
                    "dtlist": null,
                    "dtcsslist": null,
                    "btlist": null,
                    "btcsslist": null
                },
                "type": null
            }
        },
        /**
         * 代码对象存放
         */
        codeObj: null,
        /**
         * 移除本地储存
         * @param key
         */
        remove: function (key) {
            this.loacl.remove(key);
        },
        /**
         * 列出本地代码
         * @returns {Array}
         */
        listCode: function () {
            var codes = this.loacl.keys();
            var codearry = [];
            for (var i = 0; i < codes.length; i++) {
                var c = codes[i];
                if (c.indexOf("code_datatables_club") != -1) {
                    codearry.push(c);
                }
            }
            return codearry;
        },
        /**
         * 创建本地代码list
         */
        createCodeList: function () {
            this.empty();
            this.createLI();
        },
        /**
         * 创建本地代码li
         */
        createLI: function () {
            var codelis = this.listCode();
            var codelisttplobj = $("#codelistlitpl").html();
            for (var c = 0; c < codelis.length; c++) {
                var key = codelis[c];
                var codecontent = save_load.getCode(key);
                var cusName = codecontent.key.split("_")[3];
                cusName = parseInt(cusName);
                var date = new Date(cusName);
                codecontent.name = codecontent.name || date.getFullYear() + "-" + (date.getMonth() + 1) + "-" + date.getDate() + " " + date.getHours() + ":" + date.getMinutes() + ":" + date.getSeconds() + "代码保存";
                var lihtml = laytpl(codelisttplobj).render(codecontent);
                $("#codelist").append(lihtml);
            }
        },
        /**
         * 清空代码列表
         */
        empty: function () {
            $("#codelist").empty();
        },
        /**
         * 得到代码
         * @param key
         * @returns {*}
         */
        getCode: function (key) {
            return this.loacl.get(key);
        },
        /**
         * 保存代码到本地储存
         * @param json
         */
        setCode: function (json) {
            var jscode = json.jscode || js_code.getValue();
            var csscode = json.csscode || css_code.getValue();
            var htmlcode = json.htmlcode || html_code.getValue();

            var jquerylist = json.resourse.jquerylist || $("#jquerylist").val();
            var dtlist = json.resourse.dtlist || $("#dtlist").val();
            var dtcsslist = json.resourse.dtcsslist || $("#dtcsslist").val();
            var btlist = json.resourse.btlist || $("#btlist").val();
            var btcsslist = json.resourse.btcsslist || $("#btcsslist").val();

            this.init();
            this.codeObj.key = json.key || "code_datatables_club_" + new Date().getTime();
            this.codeObj.jscode = jscode;
            this.codeObj.csscode = csscode;
            this.codeObj.htmlcode = htmlcode;
            this.codeObj.name = json.name;
            this.codeObj.type = json.type;
            this.codeObj.resourse.jquerylist = jquerylist;
            this.codeObj.resourse.dtlist = dtlist;
            this.codeObj.resourse.dtcsslist = dtcsslist;
            this.codeObj.resourse.btlist = btlist;
            this.codeObj.resourse.btcsslist = btcsslist;

            this.loacl.set(this.codeObj.key, this.codeObj);
        }
    };


    /**
     * 初始化codemirror
     * @param id
     * @param mode
     * @param obj
     * @returns {*}
     */
    function initCodeMirror(id, mode, obj) {
        return obj || CodeMirror.fromTextArea(document.getElementById(id), {
                    lineNumbers: !0,
                    matchBrackets: !0,
                    lineWrapping: !0,
                    mode: mode,
                    tabSize: 2,
                    wordWrap: true,
                    autoCloseTags: true
                });
    }

    /**
     * 格式化编辑器里的代码
     * @param editor
     */
    function formatCode(editor){
        var range = getSelectedRange(editor);
        if(range.from.ch){
            editor.autoFormatRange(range.from, range.to);
        }else{
            CodeMirror.commands["selectAll"](editor);
            range = getSelectedRange(editor);
            editor.autoFormatRange(range.from, range.to);
        }

    }

    /**
     * 选择被格式的代码范围
     * @param editor
     * @returns {{from: *, to: *}}
     */
    function getSelectedRange(editor) {
        return { from: editor.getCursor(true), to: editor.getCursor(false) };
    }

    function createHtmlContent(json){
        var h = "", b = "";
        h += resultcombine("btcsslist",json.btcsslist, true) + '\n';
        h += resultcombine("dtcsslist",json.dtcsslist ,true) + '\n';
        h += creater_doc.createStyleContentHtml(json.csscode) + '\n';
        b += json.htmlcode + '\n';
        b += resultcombine("jquerylist",json.jquerylist,  false) + '\n';
        b += resultcombine("btlist",json.btlist,  false) + '\n';
        b += resultcombine("dtlist", json.dtlist, false) + '\n';
        b += creater_doc.createSriptContentHtml(json.jscode) + '\n';
        return  '<html>\n<head><meta charset="utf-8">\n' + h + '</head>\n<body>\n' + b + '</body>\n</html>';
    }

    function resultcombine(id, data, type) {
        var sb = "";
        var selectObj = $("#" + id);
        var selectDom = selectObj.data(selectObj.attr("id") + "-data");
        var selectval = data;
        $(selectDom).each(function (index, obj) {
            if (selectval) {
                for (var i = 0; i < selectval.length; i++) {
                    if (selectval[i] == obj.id) {
                        if (type) {
                            sb += creater_doc.createLinkHtml(obj.url) + '\n';
                        } else {
                            sb += creater_doc.createScriptHtml(obj.url) + '\n'
                        }
                    }
                }
            }
        });
        return sb;
    }

    /**
     * 运行代码
     */
    function runit() {
//        css_code = initCodeMirror("css_code", "text/css", css_code);
//        js_code = initCodeMirror("js_code", "text/javascript", js_code);
        creater_doc.createiframe(function () {
            var json = {
                "jscode": js_code.getValue(),
                "csscode": css_code.getValue(),
                "htmlcode": html_code.getValue(),
                "dtcsslist": $("#dtcsslist").val(),
                "btlist": $("#btlist").val(),
                "jquerylist": $("#jquerylist").val(),
                "dtlist": $("#dtlist").val(),
                "btcsslist": $("#btcsslist").val()
            };
            return createHtmlContent(json);
        });
    }

    var creater_doc = {
        doc: null,
        createiframe: function (appendfun) {
            $("#result").html($("<iframe />", {
                id: "view",
                width: "100%",
                height: "550px",
                frameBorder: "0"
            }));
            var m = $("#view")[0];
            if (m.contentDocument) {
                this.doc = m.contentDocument
            } else {
                if (m.contentWindow) {
                    this.doc = m.contentWindow.document
                } else {
                    this.doc = m.document
                }
            }
            htmlcontent = appendfun();
            this.doc.open();
            this.doc.writeln(htmlcontent);
            this.doc.close();
        },
        init: function (odoc) {
            this.doc = odoc;
        },
        createDomHtml: function () {
            var domHtml = $("#result_html_tmpl").html();
            domHtml = $(domHtml);
            return domHtml;
        },
        createScriptHtml: function (src) {
            var scriptHtml = "<script src='" + src + "' type='text/javascript' ><\/script>";
            return scriptHtml;
        },
        createScript: function (src) {
            var fileElement = this.doc.createElement("script");
            fileElement.type = "text/javascript";
            fileElement.src = src;
            this.doc.getElementsByTagName("head")[0].appendChild(fileElement);
        },
        createSriptContentHtml: function (code) {
            var scriptHtml = "<script type='text/javascript' >" + code + "<\/script>";
            return scriptHtml;
        },
        createScriptContent: function (code) {
            var fileElement = this.doc.createElement("script");
            fileElement.type = "text/javascript";
            fileElement.innerHTML = code;
//            this.doc.getElementsByTagName("head")[0].appendChild(fileElement);
            this.doc.body.appendChild(fileElement);
        },
        createLinkHtml: function (src) {
            var scriptHtml = "<link href='" + src + "' rel='stylesheet' />";
            return scriptHtml;
        },
        createStyleContentHtml: function (code) {
            var scriptHtml = "<style>" + code + "<\/style>";
            return scriptHtml;
        },
        createStyle: function (code) {
            var fileElement = this.doc.createElement("style");
            fileElement.innerHTML = code;
            this.doc.getElementsByTagName("head")[0].appendChild(fileElement);
        },
        createLink: function (src) {
            var fileElement = this.doc.createElement("link");
            fileElement.href = src;
            fileElement.rel = "stylesheet";
            this.doc.getElementsByTagName("head")[0].appendChild(fileElement);
        },
        createElement: function (ele, content) {
            var fileElement = this.doc.createElement(ele);
            fileElement.innerHTML = content;
            return fileElement;
        }
    };

    function code_ajax(url, callback) {
        $.ajax({
            url: url,
            success: function (data) {
                callback(data);
            }
        });
    }

    function selectCreate(name, id, val) {
        code_ajax("./assets/" + name + ".txt", function (data) {
            data = JSON.parse(data);
            var select = $("#" + id);
            select.data(id + "-data", data);
            $(data).each(function (index, obj) {
                select.append("<option value='" + obj.id + "'>" + obj.name + " " + obj.version + "</option>");
            });
            select.val(val);
        });
    }

    $(document).on("change", "select", function () {
        combineResourseList();
    });

    /**
     * 列出被使用的资源文件
     */
    function combineResourseList() {
        var resourselist = "";
        var jquerylist_data = $("#jquerylist");
        var dtlist_data = $("#dtlist");
        var dtcsslist_data = $("#dtcsslist");
        var btlist_data = $("#btlist");
        var btcsslist_data = $("#btcsslist");

        resourselist = combine(resourselist, jquerylist_data);
        resourselist = combine(resourselist, btcsslist_data);
        resourselist = combine(resourselist, dtcsslist_data);
        resourselist = combine(resourselist, btlist_data);
        resourselist = combine(resourselist, dtlist_data);

        $("#resourselist").val(resourselist);

        function combine(resourselist, data) {
            var selectDom = data.data(data.attr("id") + "-data");
            var selectval = data.val();
            $(selectDom).each(function (index, obj) {
                if (selectval) {
                    for (var i = 0; i < selectval.length; i++) {
                        if (selectval[i] == obj.id) {
                            resourselist += obj.url + "\n";
                        }
                    }
                } else {
                    return resourselist;
                }
            });
            return resourselist;
        }
    }

    /**
     * 保存代码为html文件
     * @param code
     */
    function saveToFile(key) {
        var codeObj = save_load.getCode(key);
        var json = {
            "jscode": codeObj.jscode,
            "csscode": codeObj.csscode,
            "htmlcode": codeObj.htmlcode,
            "dtcsslist": codeObj.resourse.dtcsslist,
            "btlist": codeObj.resourse.btlist,
            "jquerylist": codeObj.resourse.jquerylist,
            "dtlist": codeObj.resourse.dtlist,
            "btcsslist": codeObj.resourse.btcsslist
        };
        var code = createHtmlContent(json);
        var b = new Blob([code]);
        saveAs(b, "datatables.club.html");
    }


</script>
</body>
</html>
