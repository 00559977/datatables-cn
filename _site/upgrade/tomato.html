<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>:)</title>
    <link href="./css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="./css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="./css/buttons.dataTables.min.css">
    <script src="./js/jquery-2.0.0.js"></script>
    <script src="./js/jquery.dataTables.min.js"></script>
    <script src="./js/dataTables.buttons.min.js"></script>
    <script src="./js/jszip.min.js"></script>
    <script src="./js/pdfmake.min.js"></script>
    <script src="./js/vfs_fonts.js"></script>
    <script src="./js/buttons.html5.min.js"></script>
    <script src="./js/buttons.print.min.js"></script>
    <script src="./js/buttons.flash.min.js"></script>
</head>
<body>
<table  class="table table-datatable table-custom" id="inlineEditDataTable">
</table>

</body>
<script>

    if(!window.localStorage){
        alert('不支持 localStorage,会影响使用功能');
    }

    function restoreRow(oTable02, nRow) {
        var aData = oTable02.row(nRow).data();
        var jqTds = $('>td', nRow);
        var arr = createRowObj(aData.id,aData.name,aData.action);
        oTable02.row(nRow).data(arr).draw();
    }

    function editRow(oTable02, nRow) {
        var aData = oTable02.row(nRow).data();
        var jqTds = $('>td', nRow);
        $(jqTds[0]).html(createInput(aData.name));
        $(jqTds[1]).html(createButton("save"));
        oTable02.draw();
        updateData(oTable02.data());
    }

    function dealwithData(tmpData){
        var arrTmp = [];
        for(var i = 0;i<tmpData.length;i++){
            arrTmp.push(tmpData[i]);
        }
        return arrTmp;
    }

    function createButton(type){
        if(type === 'save'){
            return '<a class="edit save" href="#">保存</a>|<a class="delete" href="#">删除</a>';
        }else{
            return '<a class="edit" href="#">编辑</a>|<a class="delete" href="#">删除</a>';
        }
    }
    function createInput(val){
        return '<input type="text" value="' + val + '" class="form-control">';
    }

    function saveRow(oTable02, nRow) {
        var jqInputs = $('input', nRow);
        var rowObj = oTable02.row(nRow);
        var id = rowObj.data().id;
        var tmpobj = createRowObj(id, $(jqInputs[0]).val(), createButton());
        rowObj.data(tmpobj).draw();
        updateData(oTable02.data());
    }

    function getInfo(){
       /* 属性	描述	IE	F	O
        appCodeName	返回浏览器的代码名。	4	1	9
        appMinorVersion	返回浏览器的次级版本。	4	No	No
        appName	返回浏览器的名称。	4	1	9
        appVersion	返回浏览器的平台和版本信息。	4	1	9
        browserLanguage	返回当前浏览器的语言。	4	No	9
        cookieEnabled	返回指明浏览器中是否启用 cookie 的布尔值。	4	1	9
        cpuClass	返回浏览器系统的 CPU 等级。	4	No	No
        onLine	返回指明系统是否处于脱机模式的布尔值。	4	No	No
        platform	返回运行浏览器的操作系统平台。	4	1	9
        systemLanguage	返回 OS 使用的默认语言。	4	No	No
        userAgent	返回由客户机发送服务器的 user-agent 头部的值。	4	1	9
        userLanguage	返回 OS 的自然语言设置。*/
        var infos = [];
        infos.push(createRowObj(null,"appCodeName: "+navigator.appCodeName,null));
        infos.push(createRowObj(null,"appName: "+navigator.appName,null));
        infos.push(createRowObj(null,"appVersion: "+navigator.appVersion,null));
        infos.push(createRowObj(null,"javaEnabled: "+navigator.javaEnabled(),null));
        infos.push(createRowObj(null,"cookieEnabled: "+navigator.cookieEnabled,null));
        infos.push(createRowObj(null,"onLine: "+navigator.onLine,null));
        infos.push(createRowObj(null,"platform: "+navigator.platform,null));
        infos.push(createRowObj(null,"systemLanguage: "+navigator.systemLanguage,null));
        infos.push(createRowObj(null,"userAgent: "+navigator.userAgent,null));
        infos.push(createRowObj(null,"userLanguage: "+navigator.userLanguage,null));
        return infos;
    }

    function getData(){
        var loaclData = localStorage.getItem("datatables-cn-data");
        if(!loaclData){
            loaclData = {
                "data":{
                    "data":getInfo()
                }
            };
            loaclData =  JSON.stringify(loaclData);
            localStorage.setItem("datatables-cn-data",loaclData);
        }
        return JSON.parse(loaclData);
    }

    function setData(data){
        var parseData =  JSON.stringify(data);
        localStorage.setItem("datatables-cn-data",parseData);
    }

    function updateData(data){
        var loaclData = getData();
        loaclData.data.data = dealwithData(data);
        setData(loaclData);
    }

    function createRowObj(id, name, action) {
        var actionTem = createButton();
        return {"id": id || new Date().getTime(), "name": name || "default", "action": action || actionTem};
    }

    var oTable02 = $('#inlineEditDataTable').DataTable({
        "dom": "BR<'row'<'col-md-6'l><'col-md-6'f>r>" +
        "t" +
        "<'row'<'col-md-4 sm-center'i><'col-md-4'><'col-md-4 text-right sm-center'p>>",
        "columnDefs": [
            {'title': "name", 'targets': 0},
            {'title': "操作", 'targets': 1}
        ],
        "columns": [
            {"data": "name"},
            {"data": "action"}
        ],
        "data": getData().data.data,
        "language": {
            "url": "/assets/Chinese.txt"
        },
        "buttons": [
            {
                extend: 'copy',
                text: '复制到剪贴板'
            },{
                extend: 'csv',
                text: '导出cvs'
            },{
                extend: 'excel',
                text: '导出excel'
            },{
                extend: 'pdf',
                text: '导出pdf'
            },{
                extend: 'print',
                text: '打印'
            } ,{
                text: '添加一行',
                action: function ( e, dt, node, config ) {
                    e.preventDefault();

                    // Only allow a new row when not currently editing
                    if (nEditing !== null) {
                        return;
                    }

                    var aiNew = oTable02.row.add(createRowObj());
                    var nRow = oTable02.row(aiNew[0]).node();
                    editRow(oTable02, nRow);
                    nEditing = nRow;

                    $(aiNew).find('td:last-child').addClass('actions text-center');
                }
            }
        ]
    });

    var nEditing = null;

    // Delete row initialize
    $(document).on("click", "#inlineEditDataTable a.delete", function (e) {
        e.preventDefault();
        var nRow = $(this).parents('tr')[0];
        var id = oTable02.row(nRow).data().id;
        var dtData = dealwithData(oTable02.data());
        var finalData = $.grep(dtData, function( n, i ) {
            return n.id != id;
        });
        oTable02.row(nRow).remove().draw();
        updateData(finalData);
    });

    // Edit row initialize
    $(document).on("click", "#inlineEditDataTable a.edit", function (e) {
        e.preventDefault();

        /* Get the row as a parent of the link that was clicked on */
        var nRow = $(this).parents('tr')[0];

        if (nEditing !== null && nEditing != nRow) {
            /* A different row is being edited - the edit should be cancelled and this row edited */
            restoreRow(oTable02, nEditing);
            editRow(oTable02, nRow);
            nEditing = nRow;
        }
        else if (nEditing == nRow && this.innerHTML == "保存") {
            /* This row is being edited and should be saved */
            saveRow(oTable02, nEditing);
            nEditing = null;
        }
        else {
            /* No row currently being edited */
            editRow(oTable02, nRow);
            nEditing = nRow;
        }
    });

</script>
</html>